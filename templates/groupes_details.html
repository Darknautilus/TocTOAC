{% extends 'layout.html' %}

{% block title %}Groupes{% endblock %}

{% block content %}

<div class="row">
	<div class="pull-right">
	  {% if isLogged() and isMbPlus(groupe.grpid) %}<a class="btn btn-small" href="{{ queries('groupes','modifier',{'idGroupe': groupe.grpid}) }}"><i class="icon-white icon-wrench"></i> Modifier</a>{% endif %}
	</div>
	<div>
	 <h3 class="page-header">{{ groupe.grpname }}</h3>
	</div>
</div>
<div class="row">
<div class="span9">

<h4>Description</h4>
<p align="justify"> 
{{ groupe.description }}
</p>

<br/>
<h4>Evènements créés</h4>
<table class="table table-striped table-hover table-bordered">
	<thead>
		<tr>
			<th>Nom</th>	
			<th>Organisateur</th>
			<th>Date</th>
			<th>Heure</th>
			{% if isLogged() and isMb(groupe.grpid) %}
			<th></th>
			{% endif %}
		</tr>
	<tbody>
	{% for event in events %}
		<tr>
			{% set tab = {'idEvent':event.eventid} %}
			<td>{{ event.eventname }}</td>
			<td>{{ event.membfirstname }} {{ event.memblastname }}</td>
			<td>{{ sqlDatetimeToFrench(event.date,'DATE') }}</td>
			<td>{{ event.time }}</td>
			{% if isLogged() and isMb(groupe.grpid) %}
			<td>
			    <div class="btn-group">
			        <a class="btn" href="{{ queries('events','details',{'eventid':event.eventid}) }}">+</a>
    				  {% if not participate(event.eventid) %}
    				  <a class="btn" href="{{ queries('events','participer',{'idevent':event.eventid}) }}">Participer</a>
    				  {% elseif isCreator(event.eventid) %}
      				<a class="btn" href = "{{ queries('events','modifier_detail',{'idevent': event.eventid}) }}">Modifier l'evenement</a>
      			  {% endif %}
    			</div>
		  </td>
    	{% endif %}
		</tr>
	{% endfor %}
	</tbody>
</table>
  <div >
	 {% if isLogged() %}
	   {% if isMb(groupe.grpid) %}
	     {% if isMbPlus(groupe.grpid) %}
       {% set tabCat = {"nom" : groupe.grpname, 'idGroupe':groupe.grpid } %}
	     <a class="btn" href="{{ queries('groupes','creerCat', tabCat) }}">Creer catégorie</a>
	     <a class="btn" href="{{ queries('groupes','supprimerCat', tabCat) }}">Supprimer catégorie</a>
	     {% endif %}
	     <a class="btn" href="{{ queries('events','creer',{'grpid':groupe.grpid}) }}">Créer évenement</a>
	   {% else %}
	   <a href= "{{ queries('groupes', 'rejoindre', {'idGroupe':groupe.grpid}) }}" class="btn">Rejoindre ce groupe</a>
     {% endif %}
   {% endif %}
  </div>
</div>

<div class="span3">

<table class="table table-striped table-hover table-bordered">
	<thead>
	<tr>
		<th>Membres  {% if isLogged() and isMbPlus(groupe.grpid) %}<a class="btn pull-right" href = "{{ queries('groupes','inviter_membre',{'grpid': groupe.grpid}) }}"><i class="icon-group icon-white"></i> Inviter</a>{% endif %}</th>
		</tr>
	</thead>
	<tbody>
	{% for membre in membres %}
		<tr>
			<td>
			<div class="span2">
			{{ membre.membfirstname }} {{ membre.memblastname }}
			</div>
			{% if isLogged() %}
			<div class="span2">
				<div class="span1">
					<div class="btn-toolbar">
						<div class="btn-group">
			    				<a class="btn" href="{{ queries('membres','details',{'membid':membre.membid}) }}"><i class="icon-user icon-white"></i></a>
			    				{% if isMb(groupe.grpid) and membre.membid != loggedMember().id %}
			    				 {% if isMbPlus(groupe.grpid) %}
			    				   {% if not isMbPlus(groupe.grpid,membre.membid) %}
			    				     <button class="btn" href="#grant_confirm" data-toggle="modal"><i class="icon-plus icon-white"></i></button>
								       {% import 'modal.html' as showModal %}
								       {{ showModal.modal('grant_confirm', 'Accorder droits au membre?', 'Voulez vous vraiment donner les droits à ce membre?', 'Oui', queries('groupes', 'donner_droits_membre', { 'id' : membre.membid, 'idG' : groupe.grpid}), 'Non') }}
			    				   {% endif %}
			    				   <button class="btn" href="#delete_confirm" data-toggle="modal"><i class="icon-remove icon-white"></i></button>
			    				   {{ showModal.modal('delete_confirm', 'Supprimer membre ?', 'Voulez vous vraiment supprimer ce membre?', 'Oui', queries('groupes','supprimer_membre', { 'id' : membre.membid , 'idG' : groupe.grpid}), "Non") }}
			    				 {% endif %}
			    				{% endif %}
			    		</div>
		    		</div>
	    		</div>
	    	</div>
	    	{% endif %}
	    	</td>
		</tr>
	{% endfor %}
		<tr>
			<td>
    		<a class="btn btn-block" href = "{{ queries('groupes','afficher_membre',{'idGroupe': groupe.grpid}) }}">Afficher tous les membres ({{ nbMembres }})</a>
		  </td>
		</tr>
	</tbody>
</table>
</div>
</div>
{% endblock %}